// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapi 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling17B49968": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling2758A4E3",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiALBListenerRulePrio17D0F6C2": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiefsAccessPointId2F143851": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiStackCommonALBListenerSecurityGroupsg1234567890126C70BC8A808016E74591": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiStackCommonALBListenerSecurityGroupsg1234567890126C70BC8A80802F026FFF": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiUsingMultipleExternalSources 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling17B49968": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiUsingMultipleExternalSourcesStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling7DCB1505",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiALBListenerRulePrio17D0F6C2": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/CDB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/CDB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/CDB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/AMB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/AMB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/AMB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/CDB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/CDB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/CDB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/AMB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/AMB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-fastapi/secrets/AMB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiefsAccessPointId2F143851": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiUsingMultipleExternalSourcesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg12345678901248172C068080EE156279": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg12345678901248172C0680803FF7422A": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling17B49968": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithApimStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling417180F2",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiALBListenerRulePrio17D0F6C2": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "tst-api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiefsAccessPointId2F143851": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithApimStackCommonALBListenerSecurityGroupsg123456789012447DC190808067E2FBCB": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiWithApimStackCommonALBListenerSecurityGroupsg123456789012447DC190808004D936E8": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithExpose2APIM 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling17B49968": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithExpose2APIMStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScalingFD3E4DFC",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiALBListenerRulePrio17D0F6C2": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiefsAccessPointId2F143851": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithExpose2APIMStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithExpose2APIMStackCommonALBListenerSecurityGroupsg1234567890129889943480802271F167": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiWithExpose2APIMStackCommonALBListenerSecurityGroupsg123456789012988994348080A76BB26F": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithRDS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling17B49968": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithRDSStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScalingA13BA200",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiALBListenerRulePrio17D0F6C2": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiefsAccessPointId2F143851": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithRDSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithRDSStackCommonALBListenerSecurityGroupsg123456789012FAEC1535808084FF12BE": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiWithRDSStackCommonALBListenerSecurityGroupsg123456789012FAEC153580800C49DE43": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithSnowflake 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling17B49968": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithSnowflakeStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling3148BAF5",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiALBListenerRulePrio17D0F6C2": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiefsAccessPointId2F143851": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithSnowflakeStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890125CDF778980800572A057": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890125CDF778980800B724714": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithSnowflakeAndApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling17B49968": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithSnowflakeAndApimStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScalingECBFE452",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiALBListenerRulePrio17D0F6C2": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "tst-api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiefsAccessPointId2F143851": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithSnowflakeAndApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg1234567890121F32BDE8808072667B98": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg1234567890121F32BDE88080767E458B": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTask 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskStackCommonALBListenerSecurityGroupsg123456789012DAF6815B80801519B932": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService1B8BABC2": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService1B8BABC2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling2687E2DD": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling84DA3A05",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameALBListenerRulePrio9722FAA3": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/fastapi-task-appName",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTargetGroupC129AB59": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/fastapi-task-appName",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "fastapitaskappNameEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService1B8BABC2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameefsAccessPointIdF94D900B": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskStackCommonALBListenerSecurityGroupsg123456789012DAF6815B8080672004C0": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTaskUsingMultipleExternalSources 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskUsingMultipleExternalSourcesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg123456789012846E904080802A780D5E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService1B8BABC2": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService1B8BABC2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling2687E2DD": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskUsingMultipleExternalSourcesStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling9ADB481C",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameALBListenerRulePrio9722FAA3": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/fastapi-task-appName",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/CDB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/CDB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/CDB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/AMB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/AMB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/AMB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTargetGroupC129AB59": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/fastapi-task-appName",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/CDB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/CDB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/CDB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/AMB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/AMB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/AMB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "fastapitaskappNameEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskUsingMultipleExternalSourcesStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService1B8BABC2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameefsAccessPointIdF94D900B": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg123456789012846E904080803618E82E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTaskWithApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskWithApimStackCommonALBListenerSecurityGroupsg1234567890122F0BDBB98080E6D466CE": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService1B8BABC2": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService1B8BABC2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling2687E2DD": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskWithApimStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling8C29F981",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameALBListenerRulePrio9722FAA3": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/fastapi-task-appName",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTargetGroupC129AB59": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/fastapi-task-appName",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "fastapitaskappNameEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithApimStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService1B8BABC2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameefsAccessPointIdF94D900B": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskWithApimStackCommonALBListenerSecurityGroupsg1234567890122F0BDBB9808024047EF2": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTaskWithExpose2APIM 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithExpose2APIMStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskWithExpose2APIMStackCommonALBListenerSecurityGroupsg1234567890125352B26E80807F4E9C14": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService1B8BABC2": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService1B8BABC2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling2687E2DD": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskWithExpose2APIMStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScalingEFEC6ECC",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameALBListenerRulePrio9722FAA3": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/fastapi-task-appName",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTargetGroupC129AB59": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/fastapi-task-appName",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "fastapitaskappNameEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithExpose2APIMStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService1B8BABC2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameefsAccessPointIdF94D900B": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskWithExpose2APIMStackCommonALBListenerSecurityGroupsg1234567890125352B26E808089D26B40": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTaskWithRDS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithRDSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskWithRDSStackCommonALBListenerSecurityGroupsg1234567890122A5AD9FD8080C9D8032A": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService1B8BABC2": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService1B8BABC2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling2687E2DD": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskWithRDSStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling4A30C17A",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameALBListenerRulePrio9722FAA3": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/fastapi-task-appName",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTargetGroupC129AB59": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/fastapi-task-appName",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "fastapitaskappNameEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithRDSStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService1B8BABC2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameefsAccessPointIdF94D900B": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskWithRDSStackCommonALBListenerSecurityGroupsg1234567890122A5AD9FD8080A5CABA48": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTaskWithSnowflake 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithSnowflakeStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890128A95F74B8080E77A9D89": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService1B8BABC2": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService1B8BABC2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling2687E2DD": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskWithSnowflakeStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScalingC8CF85FA",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameALBListenerRulePrio9722FAA3": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/fastapi-task-appName",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTargetGroupC129AB59": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/fastapi-task-appName",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "fastapitaskappNameEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithSnowflakeStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService1B8BABC2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameefsAccessPointIdF94D900B": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890128A95F74B8080751040B9": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTaskWithSnowflakeAndApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithSnowflakeAndApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg123456789012C356FDBA8080B39F5B50": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService1B8BABC2": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService1B8BABC2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling2687E2DD": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskWithSnowflakeAndApimStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling0AD782E5",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameALBListenerRulePrio9722FAA3": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/fastapi-task-appName",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTargetGroupC129AB59": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/fastapi-task-appName",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "fastapitaskappNameEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithSnowflakeAndApimStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService1B8BABC2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameefsAccessPointIdF94D900B": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg123456789012C356FDBA8080935D10BC": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTaskWithUserDefinedVariables 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/mybackend/anotherpath/MY_EXTRA_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithUserDefinedVariablesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg1234567890121ED310C080808F0A5159": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService1B8BABC2": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService1B8BABC2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling2687E2DD": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskWithUserDefinedVariablesStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling733A7C99",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameALBListenerRulePrio9722FAA3": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/fastapi-task-appName",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTargetGroupC129AB59": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "TEST_PARAM",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "TEST_PARAM1",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "MY_EXTRA_PARAM",
                "Value": {
                  "Ref": "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/fastapi-task-appName",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "fastapitaskappNameEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithUserDefinedVariablesStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService1B8BABC2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameefsAccessPointIdF94D900B": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg1234567890121ED310C080809F4A8C8D": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTaskWithoutReuseALB 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "fastapitaskappNameALBFargateServiceLoadBalancerDNSD1C12DA7": {
      "Value": {
        "Fn::GetAtt": [
          "fastapitaskappNameALBFargateServiceLBD6104016",
          "DNSName",
        ],
      },
    },
    "fastapitaskappNameALBFargateServiceServiceURL92BF5D56": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Fn::GetAtt": [
                "fastapitaskappNameALBFargateServiceLBD6104016",
                "DNSName",
              ],
            },
          ],
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": {
            "Fn::Join": [
              "",
              [
                "dualstack.",
                {
                  "Fn::GetAtt": [
                    "fastapitaskappNameALBFargateServiceLBD6104016",
                    "DNSName",
                  ],
                },
              ],
            ],
          },
          "HostedZoneId": {
            "Fn::GetAtt": [
              "fastapitaskappNameALBFargateServiceLBD6104016",
              "CanonicalHostedZoneID",
            ],
          },
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithoutReuseALBStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskWithoutReuseALBStackfastapitaskappNameALBFargateServiceLBSecurityGroup057905C6808096BB246E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "fastapitaskappNameALBFargateServiceLBSecurityGroupDB59DA83",
            "GroupId",
          ],
        },
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService84CC6374": {
      "DependsOn": [
        "fastapitaskappNameALBFargateServiceLBPublicListenerECSGroupE9A16073",
        "fastapitaskappNameALBFargateServiceLBPublicListener94673512",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "CapacityProviderStrategy": [
          {
            "CapacityProvider": "FARGATE_SPOT",
            "Weight": 1,
          },
        ],
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 100,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "DesiredCount": 1,
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameALBFargateServiceLBPublicListenerECSGroupE9A16073",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "ServiceName": "fastapi-task-appNameService",
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceLBD6104016": {
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false",
          },
        ],
        "Scheme": "internet-facing",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "fastapitaskappNameALBFargateServiceLBSecurityGroupDB59DA83",
              "GroupId",
            ],
          },
        ],
        "Subnets": [
          "s-12345",
          "s-67890",
        ],
        "Type": "application",
      },
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
    },
    "fastapitaskappNameALBFargateServiceLBPublicListener94673512": {
      "Properties": {
        "Certificates": [
          {
            "CertificateArn": "{{resolve:ssm:/platform/v1/dns/public/wildcard_cert_arn_eu-central-1}}",
          },
        ],
        "DefaultActions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameALBFargateServiceLBPublicListenerECSGroupE9A16073",
            },
            "Type": "forward",
          },
        ],
        "LoadBalancerArn": {
          "Ref": "fastapitaskappNameALBFargateServiceLBD6104016",
        },
        "Port": 443,
        "Protocol": "HTTPS",
      },
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
    },
    "fastapitaskappNameALBFargateServiceLBPublicListenerECSGroupE9A16073": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameALBFargateServiceLBSecurityGroupDB59DA83": {
      "Properties": {
        "GroupDescription": "Automatically created Security Group for ELB PythonFastapiWithTaskWithoutReuseALBStackfastapitaskappNameALBFargateServiceLB5373E984",
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow from anyone on port 443",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameALBFargateServiceLBSecurityGrouptoPythonFastapiWithTaskWithoutReuseALBStackecsSecurityGroup4EF0D73D808067D94F29": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "fastapitaskappNameALBFargateServiceLBSecurityGroupDB59DA83",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "fastapitaskappNameALBFargateServiceLBSecurityGrouptoPythonFastapiWithTaskWithoutReuseALBStackrdsSecurityGroup3BBDE1C980809F19278C": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": "test-rds-security-group-id",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "fastapitaskappNameALBFargateServiceLBSecurityGroupDB59DA83",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTarget97D0037D": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService84CC6374",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScalingD6ED15AF": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskWithoutReuseALBStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling8F146ED6",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTarget97D0037D",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/fastapi-task-appName",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/fastapi-task-appName",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "fastapitaskappNameEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/fastapi-task-appName/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithoutReuseALBStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService84CC6374",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameefsAccessPointIdF94D900B": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskWithoutReuseALBStackfastapitaskappNameALBFargateServiceLBSecurityGroup057905C68080937B2D04": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "fastapitaskappNameALBFargateServiceLBSecurityGroupDB59DA83",
            "GroupId",
          ],
        },
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithTaskWithoutUseEFS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "fastapitaskappNameCluster3A0F47DC",
      },
    },
    "EndPointURL": {
      "Value": "https://fastapi-task-appName.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "fastapitaskappNameExecutionRole73613E37",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "fastapi-task-appNameFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/DbfastapitaskappName/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "fastapi-task-appName-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/fastapi-task-appName",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "DbfastapitaskappName",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 7 ? * * *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "fastapitaskappNameCluster3A0F47DC",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["run_application","-m","job","-j","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithoutUseEFSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithTaskWithoutUseEFSStackCommonALBListenerSecurityGroupsg12345678901287102E938080CD599D9E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "fastapitaskappNameALBFargateService1B8BABC2": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "fastapitaskappNameCluster3A0F47DC",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "fastapitaskappNameTargetGroupC129AB59",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "fastapitaskappNameTaskDefinition53E44445",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "fastapitaskappNameCluster3A0F47DC",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fastapitaskappNameALBFargateService1B8BABC2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "fastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling2687E2DD": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithTaskWithoutUseEFSStackfastapitaskappNameALBFargateServiceTaskCountTargetCpuScaling488418B0",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fastapitaskappNameALBFargateServiceTaskCountTargetAEC84BE4",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "fastapitaskappNameALBListenerRulePrio9722FAA3": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameCluster3A0F47DC": {
      "Properties": {
        "ClusterName": "fastapi-task-appNameCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "fastapitaskappNameClusterARNBF52D536": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameCluster3A0F47DC",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRole73613E37": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameExecutionRoleARN14792607": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameExecutionRoleDefaultPolicyE4349ADA",
        "Roles": [
          {
            "Ref": "fastapitaskappNameExecutionRole73613E37",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameLogGroupARN6F58A920": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameTargetGroupC129AB59": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "fastapitaskappNameTaskDefinition53E44445": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/fastapi-task-appName/ecrRepository:0.1.83",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/fastapi-task-appName/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/DbfastapitaskappName/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbfastapitaskappNamesecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "fastapitaskappNameExecutionRole73613E37",
            "Arn",
          ],
        },
        "Family": "fastapi-task-appNameFamily",
        "Memory": "61440",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "fastapitaskappNameCluster3A0F47DC",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "fastapitaskappNameTaskDefinition53E44445",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "fastapitaskappNameCluster3A0F47DC",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "fastapitaskappNameExecutionRole73613E37",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "fastapitaskappNameTaskDefinitionEventsRoleDefaultPolicy9B3187C9",
        "Roles": [
          {
            "Ref": "fastapitaskappNameTaskDefinitionEventsRole7A72A1B7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "fastapitaskappNameTaskDefinitionSecurityGroupE0D1E554": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithTaskWithoutUseEFSStack/fastapi-task-appNameTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "fastapitaskappNameecsSecurityGroupID33FAAA86": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "fastapitaskappNameecsServiceARN52694F55": {
      "Properties": {
        "Name": "/application/v1/fastapi-task-appName/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "fastapitaskappNameALBFargateService1B8BABC2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "rdsSecurityGroupfromPythonFastapiWithTaskWithoutUseEFSStackCommonALBListenerSecurityGroupsg12345678901287102E938080169EF993": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithUserDefinedVariables 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/mybackend/anotherpath/MY_EXTRA_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling17B49968": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithUserDefinedVariablesStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScalingBE6624CB",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiALBListenerRulePrio17D0F6C2": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "TEST_PARAM",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "TEST_PARAM1",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "MY_EXTRA_PARAM",
                "Value": {
                  "Ref": "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiefsAccessPointId2F143851": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithUserDefinedVariablesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg123456789012EFC4D661808024679FC8": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg123456789012EFC4D66180809ABE2F96": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithoutReuseALB 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceLoadBalancerDNS8CBA9BCE": {
      "Value": {
        "Fn::GetAtt": [
          "autobahnfahrgestelltestpythonfastapiALBFargateServiceLB14511ED2",
          "DNSName",
        ],
      },
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceServiceURLDCE811E5": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonfastapiALBFargateServiceLB14511ED2",
                "DNSName",
              ],
            },
          ],
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": {
            "Fn::Join": [
              "",
              [
                "dualstack.",
                {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiALBFargateServiceLB14511ED2",
                    "DNSName",
                  ],
                },
              ],
            ],
          },
          "HostedZoneId": {
            "Fn::GetAtt": [
              "autobahnfahrgestelltestpythonfastapiALBFargateServiceLB14511ED2",
              "CanonicalHostedZoneID",
            ],
          },
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService1BE4079A": {
      "DependsOn": [
        "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBPublicListenerECSGroup63D19867",
        "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBPublicListener01F074CD",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "CapacityProviderStrategy": [
          {
            "CapacityProvider": "FARGATE_SPOT",
            "Weight": 1,
          },
        ],
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 100,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "DesiredCount": 1,
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBPublicListenerECSGroup63D19867",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "ServiceName": "autobahn-fahrgestell-test-python-fastapiService",
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceLB14511ED2": {
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false",
          },
        ],
        "Scheme": "internet-facing",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGroup74D841EF",
              "GroupId",
            ],
          },
        ],
        "Subnets": [
          "s-12345",
          "s-67890",
        ],
        "Type": "application",
      },
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBPublicListener01F074CD": {
      "Properties": {
        "Certificates": [
          {
            "CertificateArn": "{{resolve:ssm:/platform/v1/dns/public/wildcard_cert_arn_eu-central-1}}",
          },
        ],
        "DefaultActions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBPublicListenerECSGroup63D19867",
            },
            "Type": "forward",
          },
        ],
        "LoadBalancerArn": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceLB14511ED2",
        },
        "Port": 443,
        "Protocol": "HTTPS",
      },
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBPublicListenerECSGroup63D19867": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGroup74D841EF": {
      "Properties": {
        "GroupDescription": "Automatically created Security Group for ELB PythonFastapiWithoutReuseALBStackautobahnfahrgestelltestpythonfastapiALBFargateServiceLB277F6217",
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow from anyone on port 443",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGrouptoPythonFastapiWithoutReuseALBStackecsSecurityGroup74CCB5D98080B3CC69DA": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGroup74D841EF",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGrouptoPythonFastapiWithoutReuseALBStackrdsSecurityGroupA1812B27808074D4B478": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": "test-rds-security-group-id",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGroup74D841EF",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget55A4A149": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService1BE4079A",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling4F3411F6": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithoutReuseALBStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling37962A1F",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget55A4A149",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-fastapi",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService1BE4079A",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiefsAccessPointId2F143851": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithoutReuseALBStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithoutReuseALBStackautobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGroup2C6DF84F8080214F8744": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGroup74D841EF",
            "GroupId",
          ],
        },
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiWithoutReuseALBStackautobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGroup2C6DF84F8080A76855E1": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiALBFargateServiceLBSecurityGroup74D841EF",
            "GroupId",
          ],
        },
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonFastapiWithoutUseEFS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-fastapi.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-fastapiFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-fastapi-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-fastapi",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonfastapi",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "appContainer",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonfastapiCluster428987E8",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling17B49968": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonFastapiWithoutUseEFSStackautobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTargetCpuScaling9F87A2E3",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateServiceTaskCountTarget84EAA304",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonfastapiALBListenerRulePrio17D0F6C2": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiCluster428987E8": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-fastapiCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonfastapiClusterARND5E3813B": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiCluster428987E8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleARN85439F12": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonfastapiExecutionRoleDefaultPolicyAC4F7840",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonfastapiLogGroupARN93D96B6C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiTargetGroup258F2766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckPort": "8080",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonfastapiTaskDefinitionEA0D9F2A": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/health || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-fastapi/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonfastapi/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonfastapisecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonfastapiExecutionRoleC4944F22",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-fastapiFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonfastapiecsSecurityGroupIDD2B26408": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonfastapiecsServiceARNA1E7235F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-fastapi/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonfastapiALBFargateService57292DE4",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonFastapiWithoutUseEFSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonFastapiWithoutUseEFSStackCommonALBListenerSecurityGroupsg1234567890127A1E9BA98080308502FA": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonFastapiWithoutUseEFSStackCommonALBListenerSecurityGroupsg1234567890127A1E9BA980807442BD89": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8080,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJob 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobefsAccessPointIdC0FF8583": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJobUsingMultipleExternalSources 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobUsingMultipleExternalSourcesStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobefsAccessPointIdC0FF8583": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJobWithApim 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobWithApimStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobefsAccessPointIdC0FF8583": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJobWithExpose2APIM 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobWithExpose2APIMStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobefsAccessPointIdC0FF8583": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJobWithRDS 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobWithRDSStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobefsAccessPointIdC0FF8583": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJobWithSnowflake 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobWithSnowflakeStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobefsAccessPointIdC0FF8583": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJobWithSnowflakeAndApim 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobWithSnowflakeAndApimStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobefsAccessPointIdC0FF8583": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJobWithUserDefinedVariables 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobWithUserDefinedVariablesStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobefsAccessPointIdC0FF8583": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJobWithoutReuseALB 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobWithoutReuseALBStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobefsAccessPointIdC0FF8583": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonJobWithoutUseEFS 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleARNA57CB58C": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonjobExecutionRoleDefaultPolicyC34EA694",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonjobExecutionRoleEFA6AA4D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironmentSecurityGroupD395C31E": {
      "Properties": {
        "GroupDescription": "PythonJobWithoutUseEFSStack/autobahn-fahrgestell-test-python-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonjobFARGATEComputeEnvironment60C904CF",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-python-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestpythonjobLogGroupARN1BD7253F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonjobjobQueueCCCD029A": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonjobJobQueue9F1E59C0",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlit 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingCCEA09F3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingF6111A40",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBListenerRulePrioC5A1828E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
          {
            "Name": "tmp-main",
          },
          {
            "Name": "var-lib-amazon-ssm",
          },
          {
            "Name": "var-log-amazon-ssm",
          },
          {
            "Name": "managed-agents",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitefsAccessPointIdA5BF079F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitStackCommonALBListenerSecurityGroupsg1234567890120E041445818150CCE4FA": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitStackCommonALBListenerSecurityGroupsg1234567890120E0414458181BAEB51E4": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlitUsingMultipleExternalSources 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingCCEA09F3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitUsingMultipleExternalSourcesStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingD3EE5FF9",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBListenerRulePrioC5A1828E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/CDB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/CDB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/CDB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/AMB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/AMB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/AMB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/CDB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/CDB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/CDB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/AMB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/AMB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-python-streamlit/secrets/AMB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitefsAccessPointIdA5BF079F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitUsingMultipleExternalSourcesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg123456789012823DE76A8181B428001F": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg123456789012823DE76A818108EA342A": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlitWithApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingCCEA09F3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitWithApimStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScaling1592FC23",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBListenerRulePrioC5A1828E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "tst-api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "true",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
          {
            "Name": "tmp-apim",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitefsAccessPointIdA5BF079F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitWithApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitWithApimStackCommonALBListenerSecurityGroupsg12345678901223C6AC458181E5EA6786": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitWithApimStackCommonALBListenerSecurityGroupsg12345678901223C6AC4581810BA67AAC": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlitWithExpose2APIM 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingCCEA09F3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitWithExpose2APIMStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScaling4DE0E4F3",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBListenerRulePrioC5A1828E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitefsAccessPointIdA5BF079F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitWithExpose2APIMStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitWithExpose2APIMStackCommonALBListenerSecurityGroupsg1234567890125F890490818141F9450E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitWithExpose2APIMStackCommonALBListenerSecurityGroupsg1234567890125F89049081818FBFFC55": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlitWithRDS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingCCEA09F3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitWithRDSStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScaling98650F0C",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBListenerRulePrioC5A1828E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitefsAccessPointIdA5BF079F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitWithRDSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitWithRDSStackCommonALBListenerSecurityGroupsg12345678901285BE2AE18181A29EC227": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitWithRDSStackCommonALBListenerSecurityGroupsg12345678901285BE2AE181819494AB4C": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlitWithSnowflake 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingCCEA09F3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitWithSnowflakeStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingA9782C06",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBListenerRulePrioC5A1828E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "true",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
          {
            "Name": "tmp-snowflake",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitefsAccessPointIdA5BF079F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitWithSnowflakeStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890125E1A19C981810D76EC0B": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890125E1A19C98181CF1DCDF2": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlitWithSnowflakeAndApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingCCEA09F3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitWithSnowflakeAndApimStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingD8A61A56",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBListenerRulePrioC5A1828E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "tst-api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "true",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "true",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitefsAccessPointIdA5BF079F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitWithSnowflakeAndApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg123456789012512FF6438181A39114CF": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg123456789012512FF643818165E81D4E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlitWithUserDefinedVariables 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/mybackend/anotherpath/MY_EXTRA_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingCCEA09F3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitWithUserDefinedVariablesStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScaling3796BC35",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBListenerRulePrioC5A1828E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "TEST_PARAM",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "TEST_PARAM1",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "MY_EXTRA_PARAM",
                "Value": {
                  "Ref": "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitefsAccessPointIdA5BF079F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitWithUserDefinedVariablesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg123456789012D47882DA818125C116C9": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg123456789012D47882DA818139E68FB5": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlitWithoutReuseALB 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLoadBalancerDNS23D4BABB": {
      "Value": {
        "Fn::GetAtt": [
          "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBEF6A2DD7",
          "DNSName",
        ],
      },
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceServiceURL0ED37149": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBEF6A2DD7",
                "DNSName",
              ],
            },
          ],
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": {
            "Fn::Join": [
              "",
              [
                "dualstack.",
                {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBEF6A2DD7",
                    "DNSName",
                  ],
                },
              ],
            ],
          },
          "HostedZoneId": {
            "Fn::GetAtt": [
              "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBEF6A2DD7",
              "CanonicalHostedZoneID",
            ],
          },
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateService8DACA884": {
      "DependsOn": [
        "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBPublicListenerECSGroup5873BB03",
        "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBPublicListenerC16136EE",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "CapacityProviderStrategy": [
          {
            "CapacityProvider": "FARGATE_SPOT",
            "Weight": 1,
          },
        ],
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 100,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "DesiredCount": 1,
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBPublicListenerECSGroup5873BB03",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "ServiceName": "autobahn-fahrgestell-test-python-streamlitService",
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBEF6A2DD7": {
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false",
          },
        ],
        "Scheme": "internet-facing",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGroup7182841F",
              "GroupId",
            ],
          },
        ],
        "Subnets": [
          "s-12345",
          "s-67890",
        ],
        "Type": "application",
      },
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBPublicListenerC16136EE": {
      "Properties": {
        "Certificates": [
          {
            "CertificateArn": "{{resolve:ssm:/platform/v1/dns/public/wildcard_cert_arn_eu-central-1}}",
          },
        ],
        "DefaultActions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBPublicListenerECSGroup5873BB03",
            },
            "Type": "forward",
          },
        ],
        "LoadBalancerArn": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBEF6A2DD7",
        },
        "Port": 443,
        "Protocol": "HTTPS",
      },
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBPublicListenerECSGroup5873BB03": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGroup7182841F": {
      "Properties": {
        "GroupDescription": "Automatically created Security Group for ELB PythonStreamlitWithoutReuseALBStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceLB90529031",
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow from anyone on port 443",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGrouptoPythonStreamlitWithoutReuseALBStackecsSecurityGroup445D2BE18181C91C785E": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGroup7182841F",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGrouptoPythonStreamlitWithoutReuseALBStackrdsSecurityGroup8991B6A48181768E2189": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": "test-rds-security-group-id",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGroup7182841F",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetC476E32F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateService8DACA884",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingB3D02C58": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitWithoutReuseALBStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScaling2333CCB9",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetC476E32F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-python-streamlit",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateService8DACA884",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitefsAccessPointIdA5BF079F": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitWithoutReuseALBStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitWithoutReuseALBStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGroupBFD2F2DC81810289D556": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGroup7182841F",
            "GroupId",
          ],
        },
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitWithoutReuseALBStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGroupBFD2F2DC81815354A14C": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitALBFargateServiceLBSecurityGroup7182841F",
            "GroupId",
          ],
        },
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for PythonStreamlitWithoutUseEFS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-python-streamlit.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-python-streamlitFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-python-streamlit-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 1,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-python-streamlit",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestpythonstreamlit",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingCCEA09F3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "PythonStreamlitWithoutUseEFSStackautobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTargetCpuScalingF13B5669",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceTaskCountTarget57807496",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestpythonstreamlitALBListenerRulePrioC5A1828E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitCluster4503BD76": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-python-streamlitCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestpythonstreamlitClusterARN8EA88F10": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitCluster4503BD76",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleARN5026E3CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestpythonstreamlitExecutionRoleDefaultPolicyDE678ED1",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestpythonstreamlitLogGroupARNB1AC2F5E": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitTargetGroup3C8B8E6D": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "Auto",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinition28899667": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-python-streamlit-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [
              "run_application",
              "-m",
              "default",
            ],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "Auto",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-python-streamlit/ecrRepository:0.1.3",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestpythonstreamlit/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestpythonstreamlitsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestpythonstreamlitExecutionRoleC06F15A9",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-python-streamlitFamily",
        "Memory": "512",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestpythonstreamlitTaskDefinitionNGINXContainerLogGroup2313714F": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestpythonstreamlitecsSecurityGroupID7E8C0CEA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestpythonstreamlitecsServiceARN3627AED8": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-python-streamlit/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestpythonstreamlitALBFargateServiceB66ADFD5",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "PythonStreamlitWithoutUseEFSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromPythonStreamlitWithoutUseEFSStackCommonALBListenerSecurityGroupsg123456789012A4783A6181812A06809F": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromPythonStreamlitWithoutUseEFSStackCommonALBListenerSecurityGroupsg123456789012A4783A61818106D3D9FB": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJob 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobefsAccessPointId5FB4AB26": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJobUsingMultipleExternalSources 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobUsingMultipleExternalSourcesStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobefsAccessPointId5FB4AB26": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJobWithApim 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobWithApimStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobefsAccessPointId5FB4AB26": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJobWithExpose2APIM 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobWithExpose2APIMStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobefsAccessPointId5FB4AB26": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJobWithRDS 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobWithRDSStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobefsAccessPointId5FB4AB26": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJobWithSnowflake 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobWithSnowflakeStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobefsAccessPointId5FB4AB26": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJobWithSnowflakeAndApim 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobWithSnowflakeAndApimStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobefsAccessPointId5FB4AB26": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJobWithUserDefinedVariables 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobWithUserDefinedVariablesStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobefsAccessPointId5FB4AB26": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJobWithoutReuseALB 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-job",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobWithoutReuseALBStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobefsAccessPointId5FB4AB26": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RJobWithoutUseEFS 1`] = `
{
  "Outputs": {
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "computeenvironment": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
      },
    },
    "jobqueue": {
      "Value": {
        "Fn::Select": [
          1,
          {
            "Fn::Split": [
              "/",
              {
                "Fn::Select": [
                  5,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "autobahnfahrgestelltestrjobJobQueue0FE3068F",
                          "JobQueueArn",
                        ],
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-job",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobExecutionRole336B99B8": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrjobExecutionRoleARN8167A278": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobExecutionRole336B99B8",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-job/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrjobExecutionRoleDefaultPolicy4006CDB2",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrjobExecutionRole336B99B8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            "p-12345",
            "p-67890",
          ],
          "Type": "FARGATE_SPOT",
        },
        "ReplaceComputeEnvironment": true,
        "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/batch.amazonaws.com/AWSServiceRoleForBatch",
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {},
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentSecurityGroupD0F1C6EC": {
      "Properties": {
        "GroupDescription": "RJobWithoutUseEFSStack/autobahn-fahrgestell-test-r-jobFARGATEComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrjobJobQueue0FE3068F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrjobFARGATEComputeEnvironmentE7418A46",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "JobQueueName": "autobahn-fahrgestell-test-r-job-job-queue-tst",
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "autobahnfahrgestelltestrjobLogGroupARN557466A5": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrjobjobQueue52BC1317": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-job/jobQueueARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrjobJobQueue0FE3068F",
            "JobQueueArn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShiny 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 5,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling6DC4B1F8": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScalingCB8FDAF0",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyALBListenerRulePrio39131B18": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "5",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTargetGroupBA7AA523": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyefsAccessPointId2EF8A104": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyStackCommonALBListenerSecurityGroupsg123456789012F184D493818166EA45F0": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyStackCommonALBListenerSecurityGroupsg123456789012F184D493818131B3B927": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyUsingMultipleExternalSources 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 5,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling6DC4B1F8": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyUsingMultipleExternalSourcesStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling7B59BC87",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyALBListenerRulePrio39131B18": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "5",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/CDB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/CDB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/CDB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/AMB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/AMB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/AMB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTargetGroupBA7AA523": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/CDB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/CDB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/CDB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/AMB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/AMB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/autobahn-fahrgestell-test-r-shiny/secrets/AMB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyefsAccessPointId2EF8A104": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyUsingMultipleExternalSourcesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg1234567890128EC4693781815018EC51": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg1234567890128EC4693781817228BDD1": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 5,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling6DC4B1F8": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithApimStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling749E39CD",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyALBListenerRulePrio39131B18": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "5",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTargetGroupBA7AA523": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "tst-api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyefsAccessPointId2EF8A104": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithApimStackCommonALBListenerSecurityGroupsg123456789012F6121D89818157C001DE": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithApimStackCommonALBListenerSecurityGroupsg123456789012F6121D89818197A0ABAC": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithExpose2APIM 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 5,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling6DC4B1F8": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithExpose2APIMStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScalingB55EA457",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyALBListenerRulePrio39131B18": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "5",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTargetGroupBA7AA523": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyefsAccessPointId2EF8A104": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithExpose2APIMStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithExpose2APIMStackCommonALBListenerSecurityGroupsg12345678901267DEC9AB8181C43D2588": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithExpose2APIMStackCommonALBListenerSecurityGroupsg12345678901267DEC9AB8181170F65AB": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithRDS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 5,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling6DC4B1F8": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithRDSStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling76FAB4C1",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyALBListenerRulePrio39131B18": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "5",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTargetGroupBA7AA523": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyefsAccessPointId2EF8A104": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithRDSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithRDSStackCommonALBListenerSecurityGroupsg123456789012D6B38F1481815E101CF3": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithRDSStackCommonALBListenerSecurityGroupsg123456789012D6B38F148181ADFB15BA": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithSnowflake 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 5,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling6DC4B1F8": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithSnowflakeStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScalingAC9D5351",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyALBListenerRulePrio39131B18": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "5",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTargetGroupBA7AA523": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyefsAccessPointId2EF8A104": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithSnowflakeStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890124A76C26081815938DF92": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890124A76C2608181ACD5838C": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithSnowflakeAndApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 5,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling6DC4B1F8": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithSnowflakeAndApimStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling32009E16",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyALBListenerRulePrio39131B18": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "5",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTargetGroupBA7AA523": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "tst-api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyefsAccessPointId2EF8A104": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithSnowflakeAndApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg12345678901291B8CBAF8181CF049DC3": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg12345678901291B8CBAF8181B67A2C8D": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTask 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceE9407E63": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingA0440518": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScaling355FA4B7",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolALBListenerRulePrio8A53C7F2": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/automatische-klantinpassing-ac5-tool",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTargetGroup515C451C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/automatische-klantinpassing-ac5-tool",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolefsAccessPointIdD8BDB570": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskStackCommonALBListenerSecurityGroupsg123456789012B459248581810722C93F": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskStackCommonALBListenerSecurityGroupsg123456789012B459248581816352A43E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTaskUsingMultipleExternalSources 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceE9407E63": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingA0440518": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskUsingMultipleExternalSourcesStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingCAADDFC0",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolALBListenerRulePrio8A53C7F2": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/automatische-klantinpassing-ac5-tool",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/BAR/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/BAR/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/BAR/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/CDB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/CDB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/CDB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/AMB/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/AMB/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/AMB/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTargetGroup515C451C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/automatische-klantinpassing-ac5-tool",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/BAR/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/BAR/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "BAR_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/BAR/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/CDB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/CDB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "CDB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/CDB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/AMB/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/AMB/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "AMB_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/AMB/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskUsingMultipleExternalSourcesStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolefsAccessPointIdD8BDB570": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskUsingMultipleExternalSourcesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg1234567890121B0208F68181F687D4C6": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskUsingMultipleExternalSourcesStackCommonALBListenerSecurityGroupsg1234567890121B0208F681814717C17F": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTaskWithApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceE9407E63": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingA0440518": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskWithApimStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScaling511FF6E3",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolALBListenerRulePrio8A53C7F2": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/automatische-klantinpassing-ac5-tool",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTargetGroup515C451C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/automatische-klantinpassing-ac5-tool",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithApimStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolefsAccessPointIdD8BDB570": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskWithApimStackCommonALBListenerSecurityGroupsg123456789012780855398181BF73C4E4": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskWithApimStackCommonALBListenerSecurityGroupsg123456789012780855398181F442D107": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTaskWithExpose2APIM 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceE9407E63": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingA0440518": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskWithExpose2APIMStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingE0DE8124",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolALBListenerRulePrio8A53C7F2": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/automatische-klantinpassing-ac5-tool",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTargetGroup515C451C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/automatische-klantinpassing-ac5-tool",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithExpose2APIMStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolefsAccessPointIdD8BDB570": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithExpose2APIMStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskWithExpose2APIMStackCommonALBListenerSecurityGroupsg12345678901206CCCD4581817ACB016C": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskWithExpose2APIMStackCommonALBListenerSecurityGroupsg12345678901206CCCD4581817CC5B26A": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTaskWithRDS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceE9407E63": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingA0440518": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskWithRDSStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScaling28D50C86",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolALBListenerRulePrio8A53C7F2": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/automatische-klantinpassing-ac5-tool",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTargetGroup515C451C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/automatische-klantinpassing-ac5-tool",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithRDSStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolefsAccessPointIdD8BDB570": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithRDSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskWithRDSStackCommonALBListenerSecurityGroupsg1234567890120A9A7EF08181907FCD4E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskWithRDSStackCommonALBListenerSecurityGroupsg1234567890120A9A7EF08181D3F5B54E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTaskWithSnowflake 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceE9407E63": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingA0440518": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskWithSnowflakeStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingEFFC00A0",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolALBListenerRulePrio8A53C7F2": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/automatische-klantinpassing-ac5-tool",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTargetGroup515C451C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/automatische-klantinpassing-ac5-tool",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithSnowflakeStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolefsAccessPointIdD8BDB570": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithSnowflakeStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890121CE83E798181C23BC93D": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskWithSnowflakeStackCommonALBListenerSecurityGroupsg1234567890121CE83E798181B7CD6F4E": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTaskWithSnowflakeAndApim 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "apimSidecar": {
      "Value": "Proxy Port: 2773, Token Port: 2772",
    },
    "snowflakeSidecar": {
      "Value": "Proxy Port: 2775, Token Port: 2774",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceE9407E63": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingA0440518": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskWithSnowflakeAndApimStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScaling872309D9",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolALBListenerRulePrio8A53C7F2": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/automatische-klantinpassing-ac5-tool",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTargetGroup515C451C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/automatische-klantinpassing-ac5-tool",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
                "Value": "api.alliander.com",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2772",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2773",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-apim",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-apim",
              },
            ],
            "Name": "apim-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2772,
                "HostPort": 2772,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2773,
                "HostPort": 2773,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Environment": [
              {
                "Name": "TOKEN_EXT_AZURE_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/aad/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_STS_ENDPOINT",
                "Value": "dummy-value-for-/platform/v1/sts/token-endpoint",
              },
              {
                "Name": "TOKEN_EXT_AAD_CLIENT_ID",
                "Value": "test-sts-client-id",
              },
              {
                "Name": "TOKEN_EXT_PROXY_HOST",
              },
              {
                "Name": "TOKEN_EXT_DEBUG_ENABLED",
                "Value": "false",
              },
              {
                "Name": "TOKEN_EXT_TOKEN_SERVER_PORT",
                "Value": "2774",
              },
              {
                "Name": "TOKEN_EXT_PROXY_SERVER_PORT",
                "Value": "2775",
              },
            ],
            "Essential": true,
            "Image": "ghcr.io/alliander-opensource/aws-jwt-sts-extension",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-snowflake",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-snowflake",
              },
            ],
            "Name": "snowflake-Sidecar",
            "PortMappings": [
              {
                "ContainerPort": 2774,
                "HostPort": 2774,
                "Protocol": "tcp",
              },
              {
                "ContainerPort": 2775,
                "HostPort": 2775,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithSnowflakeAndApimStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolefsAccessPointIdD8BDB570": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithSnowflakeAndApimStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg123456789012C32152888181CC50E62B": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskWithSnowflakeAndApimStackCommonALBListenerSecurityGroupsg123456789012C321528881814414AC10": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTaskWithUserDefinedVariables 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/mybackend/anotherpath/MY_EXTRA_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceE9407E63": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingA0440518": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskWithUserDefinedVariablesStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingCA82B0A3",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolALBListenerRulePrio8A53C7F2": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/automatische-klantinpassing-ac5-tool",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTargetGroup515C451C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "TEST_PARAM",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "TEST_PARAM1",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "MY_EXTRA_PARAM",
                "Value": {
                  "Ref": "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/automatische-klantinpassing-ac5-tool",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithUserDefinedVariablesStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolefsAccessPointIdD8BDB570": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithUserDefinedVariablesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg1234567890123EB9E8648181D0B0667A": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg1234567890123EB9E86481817EEDF9B3": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTaskWithoutReuseALB 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "automatischeklantinpassingac5toolALBFargateServiceLoadBalancerDNSAFE45A96": {
      "Value": {
        "Fn::GetAtt": [
          "automatischeklantinpassingac5toolALBFargateServiceLB6DB30959",
          "DNSName",
        ],
      },
    },
    "automatischeklantinpassingac5toolALBFargateServiceServiceURLCA53D3DB": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolALBFargateServiceLB6DB30959",
                "DNSName",
              ],
            },
          ],
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": {
            "Fn::Join": [
              "",
              [
                "dualstack.",
                {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolALBFargateServiceLB6DB30959",
                    "DNSName",
                  ],
                },
              ],
            ],
          },
          "HostedZoneId": {
            "Fn::GetAtt": [
              "automatischeklantinpassingac5toolALBFargateServiceLB6DB30959",
              "CanonicalHostedZoneID",
            ],
          },
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceD49F83D2": {
      "DependsOn": [
        "automatischeklantinpassingac5toolALBFargateServiceLBPublicListenerECSGroup7F759766",
        "automatischeklantinpassingac5toolALBFargateServiceLBPublicListenerA4AAAA25",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "CapacityProviderStrategy": [
          {
            "CapacityProvider": "FARGATE_SPOT",
            "Weight": 1,
          },
        ],
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 100,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "DesiredCount": 1,
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolALBFargateServiceLBPublicListenerECSGroup7F759766",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "ServiceName": "automatische-klantinpassing-ac5-toolService",
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceLB6DB30959": {
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false",
          },
        ],
        "Scheme": "internet-facing",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "automatischeklantinpassingac5toolALBFargateServiceLBSecurityGroupE75AB502",
              "GroupId",
            ],
          },
        ],
        "Subnets": [
          "s-12345",
          "s-67890",
        ],
        "Type": "application",
      },
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
    },
    "automatischeklantinpassingac5toolALBFargateServiceLBPublicListenerA4AAAA25": {
      "Properties": {
        "Certificates": [
          {
            "CertificateArn": "{{resolve:ssm:/platform/v1/dns/public/wildcard_cert_arn_eu-central-1}}",
          },
        ],
        "DefaultActions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolALBFargateServiceLBPublicListenerECSGroup7F759766",
            },
            "Type": "forward",
          },
        ],
        "LoadBalancerArn": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceLB6DB30959",
        },
        "Port": 443,
        "Protocol": "HTTPS",
      },
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
    },
    "automatischeklantinpassingac5toolALBFargateServiceLBPublicListenerECSGroup7F759766": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolALBFargateServiceLBSecurityGroupE75AB502": {
      "Properties": {
        "GroupDescription": "Automatically created Security Group for ELB RShinyWithTaskWithoutReuseALBStackautomatischeklantinpassingac5toolALBFargateServiceLB1484FD6A",
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow from anyone on port 443",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolALBFargateServiceLBSecurityGrouptoRShinyWithTaskWithoutReuseALBStackecsSecurityGroup7872E6048181EF3D6AD4": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolALBFargateServiceLBSecurityGroupE75AB502",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "automatischeklantinpassingac5toolALBFargateServiceLBSecurityGrouptoRShinyWithTaskWithoutReuseALBStackrdsSecurityGroup56365DE98181E4D8146D": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": "test-rds-security-group-id",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolALBFargateServiceLBSecurityGroupE75AB502",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget6550B99D": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceD49F83D2",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingD86C9EC3": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskWithoutReuseALBStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScaling04655E5F",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget6550B99D",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/P/automatische-klantinpassing-ac5-tool",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/P/automatische-klantinpassing-ac5-tool",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "automatischeklantinpassingac5toolEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithoutReuseALBStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceD49F83D2",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolefsAccessPointIdD8BDB570": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithoutReuseALBStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskWithoutReuseALBStackautomatischeklantinpassingac5toolALBFargateServiceLBSecurityGroup5A5BC9FE81810AE584DB": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolALBFargateServiceLBSecurityGroupE75AB502",
            "GroupId",
          ],
        },
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskWithoutReuseALBStackautomatischeklantinpassingac5toolALBFargateServiceLBSecurityGroup5A5BC9FE8181E1F5DD0C": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolALBFargateServiceLBSecurityGroupE75AB502",
            "GroupId",
          ],
        },
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithTaskWithoutUseEFS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolCluster764D0352",
      },
    },
    "EndPointURL": {
      "Value": "https://automatische-klantinpassing-ac5-tool.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "automatische-klantinpassing-ac5-toolFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautomatischeklantinpassingac5tool/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "automatische-klantinpassing-ac5-tool-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 4,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/automatische-klantinpassing-ac5-tool",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautomatischeklantinpassingac5tool",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "Rule4C995B7F": {
      "Properties": {
        "ScheduleExpression": "cron(0 1 * * ? *)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolCluster764D0352",
                "Arn",
              ],
            },
            "EcsParameters": {
              "EnableExecuteCommand": true,
              "LaunchType": "FARGATE",
              "NetworkConfiguration": {
                "AwsVpcConfiguration": {
                  "AssignPublicIp": "DISABLED",
                  "SecurityGroups": [
                    {
                      "Fn::GetAtt": [
                        "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35",
                        "GroupId",
                      ],
                    },
                  ],
                  "Subnets": [
                    "p-12345",
                    "p-67890",
                  ],
                },
              },
              "TaskCount": 1,
              "TaskDefinitionArn": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            "Id": "Target0",
            "Input": "{"containerOverrides":[{"name":"appContainer","command":["Rscript","/srv/job.R","default"]}]}",
            "RoleArn": {
              "Fn::GetAtt": [
                "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
                "Arn",
              ],
            },
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolALBFargateServiceE9407E63": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "automatischeklantinpassingac5toolCluster764D0352",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": false,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "automatischeklantinpassingac5toolTargetGroup515C451C",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 2,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "automatischeklantinpassingac5toolCluster764D0352",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "automatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScalingA0440518": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithTaskWithoutUseEFSStackautomatischeklantinpassingac5toolALBFargateServiceTaskCountTargetCpuScaling1B0D22A6",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceTaskCountTarget2CA6E50F",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "automatischeklantinpassingac5toolALBListenerRulePrio8A53C7F2": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "4",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolCluster764D0352": {
      "Properties": {
        "ClusterName": "automatische-klantinpassing-ac5-toolCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "automatischeklantinpassingac5toolClusterARNA306CE5E": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolCluster764D0352",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRole351E9B32": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolExecutionRoleARNFD61AEA7": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolExecutionRoleDefaultPolicy4F20C933",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolExecutionRole351E9B32",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolLogGroupARNBFDF108B": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolTargetGroup515C451C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "automatischeklantinpassingac5toolTaskDefinitionC7735BD2": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "prd",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "P",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 300,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 60,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/automatische-klantinpassing-ac5-tool/ecrRepository:2.0.0.9059",
                ],
              ],
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "HANA_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_INSTANCE",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_USERNAME",
                    ],
                  ],
                },
              },
              {
                "Name": "HANA_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/application/v1/automatische-klantinpassing-ac5-tool/secrets/HANA/DB_PASSWORD",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautomatischeklantinpassingac5tool/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautomatischeklantinpassingac5toolsecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "8192",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "automatischeklantinpassingac5toolExecutionRole351E9B32",
            "Arn",
          ],
        },
        "Family": "automatische-klantinpassing-ac5-toolFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ecs:RunTask",
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "automatischeklantinpassingac5toolCluster764D0352",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Ref": "automatischeklantinpassingac5toolTaskDefinitionC7735BD2",
              },
            },
            {
              "Action": "ecs:TagResource",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecs:eu-central-1:*:task/",
                    {
                      "Ref": "automatischeklantinpassingac5toolCluster764D0352",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "automatischeklantinpassingac5toolExecutionRole351E9B32",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "automatischeklantinpassingac5toolTaskDefinitionEventsRoleDefaultPolicyC0B05420",
        "Roles": [
          {
            "Ref": "automatischeklantinpassingac5toolTaskDefinitionEventsRole66626285",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "automatischeklantinpassingac5toolTaskDefinitionNGINXContainerLogGroup431296AA": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "automatischeklantinpassingac5toolTaskDefinitionSecurityGroup3213DF35": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithoutUseEFSStack/automatische-klantinpassing-ac5-toolTaskDefinition/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "automatischeklantinpassingac5toolecsSecurityGroupID7CAD0B6C": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "automatischeklantinpassingac5toolecsServiceARN9E740E20": {
      "Properties": {
        "Name": "/application/v1/automatische-klantinpassing-ac5-tool/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "automatischeklantinpassingac5toolALBFargateServiceE9407E63",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithTaskWithoutUseEFSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithTaskWithoutUseEFSStackCommonALBListenerSecurityGroupsg1234567890129051778881811217770B": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithTaskWithoutUseEFSStackCommonALBListenerSecurityGroupsg123456789012905177888181C05F0E93": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithUserDefinedVariables 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/application/v1/autobahn-fahrgestell-test-python-fastapi/variables/TEST_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/mybackend/anotherpath/MY_EXTRA_PARAM",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 5,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling6DC4B1F8": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithUserDefinedVariablesStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScalingBFA5ACE9",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyALBListenerRulePrio39131B18": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "5",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTargetGroupBA7AA523": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "TEST_PARAM",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "TEST_PARAM1",
                "Value": {
                  "Ref": "SsmParameterValueapplicationv1autobahnfahrgestelltestpythonfastapivariablesTESTPARAM1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "MY_EXTRA_PARAM",
                "Value": {
                  "Ref": "SsmParameterValuemybackendanotherpathMYEXTRAPARAMC96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyefsAccessPointId2EF8A104": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithUserDefinedVariablesStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg1234567890129713B8948181EA1232F8": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithUserDefinedVariablesStackCommonALBListenerSecurityGroupsg1234567890129713B89481813EE8F5F9": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithoutReuseALB 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceLoadBalancerDNS6766C6ED": {
      "Value": {
        "Fn::GetAtt": [
          "autobahnfahrgestelltestrshinyALBFargateServiceLB876285C6",
          "DNSName",
        ],
      },
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceServiceURLFE8D1F29": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Fn::GetAtt": [
                "autobahnfahrgestelltestrshinyALBFargateServiceLB876285C6",
                "DNSName",
              ],
            },
          ],
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": {
            "Fn::Join": [
              "",
              [
                "dualstack.",
                {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyALBFargateServiceLB876285C6",
                    "DNSName",
                  ],
                },
              ],
            ],
          },
          "HostedZoneId": {
            "Fn::GetAtt": [
              "autobahnfahrgestelltestrshinyALBFargateServiceLB876285C6",
              "CanonicalHostedZoneID",
            ],
          },
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceB6DDA39E": {
      "DependsOn": [
        "autobahnfahrgestelltestrshinyALBFargateServiceLBPublicListenerECSGroup528A4A22",
        "autobahnfahrgestelltestrshinyALBFargateServiceLBPublicListenerEA7E41CA",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "CapacityProviderStrategy": [
          {
            "CapacityProvider": "FARGATE_SPOT",
            "Weight": 1,
          },
        ],
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 100,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "DesiredCount": 1,
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceLBPublicListenerECSGroup528A4A22",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "ServiceName": "autobahn-fahrgestell-test-r-shinyService",
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceLB876285C6": {
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false",
          },
        ],
        "Scheme": "internet-facing",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "autobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGroupAA85A3C7",
              "GroupId",
            ],
          },
        ],
        "Subnets": [
          "s-12345",
          "s-67890",
        ],
        "Type": "application",
      },
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceLBPublicListenerEA7E41CA": {
      "Properties": {
        "Certificates": [
          {
            "CertificateArn": "{{resolve:ssm:/platform/v1/dns/public/wildcard_cert_arn_eu-central-1}}",
          },
        ],
        "DefaultActions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceLBPublicListenerECSGroup528A4A22",
            },
            "Type": "forward",
          },
        ],
        "LoadBalancerArn": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceLB876285C6",
        },
        "Port": 443,
        "Protocol": "HTTPS",
      },
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceLBPublicListenerECSGroup528A4A22": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGroupAA85A3C7": {
      "Properties": {
        "GroupDescription": "Automatically created Security Group for ELB RShinyWithoutReuseALBStackautobahnfahrgestelltestrshinyALBFargateServiceLB63C72758",
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow from anyone on port 443",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGrouptoRShinyWithoutReuseALBStackecsSecurityGroupF66F94418181CA1619C8": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGroupAA85A3C7",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGrouptoRShinyWithoutReuseALBStackrdsSecurityGroup09097D588181A7FF5488": {
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": "test-rds-security-group-id",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGroupAA85A3C7",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget0F98C8CF": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceB6DDA39E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScalingC20A2B2E": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithoutReuseALBStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling7CE06D14",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget0F98C8CF",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyEfsAccessPoint": {
      "Properties": {
        "AccessPointTags": [
          {
            "Key": "DeployedBy",
            "Value": "Autobahn",
          },
          {
            "Key": "Type",
            "Value": "Application",
          },
        ],
        "FileSystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
        "PosixUser": {
          "Gid": "0",
          "Uid": "0",
        },
        "RootDirectory": {
          "CreationInfo": {
            "OwnerGid": "0",
            "OwnerUid": "0",
            "Permissions": "777",
          },
          "Path": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
        },
      },
      "Type": "AWS::EFS::AccessPoint",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/data/static/T/autobahn-fahrgestell-test-r-shiny",
                "ReadOnly": false,
                "SourceVolume": "efs-data",
              },
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
        "Volumes": [
          {
            "EFSVolumeConfiguration": {
              "AuthorizationConfig": {
                "AccessPointId": {
                  "Fn::GetAtt": [
                    "autobahnfahrgestelltestrshinyEfsAccessPoint",
                    "AccessPointId",
                  ],
                },
                "IAM": "ENABLED",
              },
              "FilesystemId": "dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/efsFileSystemId",
              "TransitEncryption": "ENABLED",
            },
            "Name": "efs-data",
          },
        ],
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceB6DDA39E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyefsAccessPointId2EF8A104": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/efsAccessPointId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyEfsAccessPoint",
            "AccessPointId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithoutReuseALBStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithoutReuseALBStackautobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGroupB2CB38C081814F5A8976": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGroupAA85A3C7",
            "GroupId",
          ],
        },
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithoutReuseALBStackautobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGroupB2CB38C08181714AA7F9": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyALBFargateServiceLBSecurityGroupAA85A3C7",
            "GroupId",
          ],
        },
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Deploy-batch-fargate-stack matches the snapshot for RShinyWithoutUseEFS 1`] = `
{
  "Outputs": {
    "ClusterName": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
      },
    },
    "EndPointURL": {
      "Value": "https://autobahn-fahrgestell-test-r-shiny.{{resolve:ssm:/platform/v1/dns/public/name}}",
    },
    "TaskDefinitionExecutionRole": {
      "Value": {
        "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
      },
    },
    "TaskDefinitionFamily": {
      "Value": "autobahn-fahrgestell-test-r-shinyFamily",
    },
    "TaskDefinitionLogGroup": {
      "Value": {
        "Ref": "LogGroupF5B46931",
      },
    },
    "TaskDefinitionTaskRole": {
      "Value": "dummy-value",
    },
    "TaskRoleArn": {
      "Value": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/db/Dbautobahnfahrgestelltestrshiny/secretArn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env1",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env2",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "env3",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": "dualstack.my-load-balancer-1234567890.us-west-2.elb.amazonaws.com",
          "HostedZoneId": "Z3DZXE0EXAMPLE",
        },
        "HostedZoneId": "{{resolve:ssm:/platform/v1/dns/public/id}}",
        "Name": "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "CommonALBListenerRuleFEF75AE0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "autobahn-fahrgestell-test-r-shiny-alb.{{resolve:ssm:/platform/v1/dns/public/name}}",
              ],
            },
          },
        ],
        "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/application/my-load-balancer/50dc6c495c0c9188/f2f7dc8efc522ab2",
        "Priority": 5,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "ECSExecRoleInlinePolicy21E186CC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:CreateControlChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "ECSExecRoleInlinePolicy",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ECSExecRoleInlinePolicy21E186CC",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogGroupF5B46931": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/application/autobahn-fahrgestell-test-r-shiny",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "RDSDBNameSecretC11F859F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "SecretString": "Dbautobahnfahrgestelltestrshiny",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "TaskRolePolicy470C6022": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
                "arn:aws:service:eu-central-1:123456789012:entity/dummy-value/*",
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "ssmmessages:CreateControlChannel",
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "logs:DescribeLogGroups",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TaskRolePolicy470C6022",
        "Roles": [
          "dummy-value",
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E": {
      "DependsOn": [
        "CommonALBListenerRuleFEF75AE0",
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "Cluster": {
          "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false,
          },
          "DeploymentCircuitBreaker": {
            "Enable": true,
            "Rollback": true,
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50,
        },
        "DeploymentController": {
          "Type": "ECS",
        },
        "EnableECSManagedTags": false,
        "EnableExecuteCommand": true,
        "HealthCheckGracePeriodSeconds": 0,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "NGINX-Proxy",
            "ContainerPort": 8181,
            "TargetGroupArn": {
              "Ref": "autobahnfahrgestelltestrshinyTargetGroupBA7AA523",
            },
          },
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecsSecurityGroupA27532EA",
                  "GroupId",
                ],
              },
              "test-rds-security-group-id",
            ],
            "Subnets": [
              "p-12345",
              "p-67890",
            ],
          },
        },
        "TaskDefinition": {
          "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionF249C912",
        },
      },
      "Type": "AWS::ECS::Service",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "MaxCapacity": 1,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "autobahnfahrgestelltestrshinyCluster64DD8C91",
              },
              "/",
              {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
                  "Name",
                ],
              },
            ],
          ],
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":iam::123456789012:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            ],
          ],
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs",
      },
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
    },
    "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScaling6DC4B1F8": {
      "DependsOn": [
        "TaskRolePolicy470C6022",
      ],
      "Properties": {
        "PolicyName": "RShinyWithoutUseEFSStackautobahnfahrgestelltestrshinyALBFargateServiceTaskCountTargetCpuScalingE8D39E58",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceTaskCountTarget578A9833",
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization",
          },
          "ScaleInCooldown": 10,
          "ScaleOutCooldown": 10,
          "TargetValue": 50,
        },
      },
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
    },
    "autobahnfahrgestelltestrshinyALBListenerRulePrio39131B18": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ApplicationLoadBalancerListenerRulePrio",
        "Type": "String",
        "Value": "5",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyCluster64DD8C91": {
      "Properties": {
        "ClusterName": "autobahn-fahrgestell-test-r-shinyCluster",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled",
          },
        ],
      },
      "Type": "AWS::ECS::Cluster",
    },
    "autobahnfahrgestelltestrshinyClusterARN71C3A1CE": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ClusterARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyCluster64DD8C91",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleARN68D4A447": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ExecutionRoleARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDF12962C": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:eu-central-1:123456789012:repository/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LogGroupF5B46931",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RDSDBNameSecretC11F859F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "autobahnfahrgestelltestrshinyExecutionRoleDefaultPolicyF1BE5623",
        "Roles": [
          {
            "Ref": "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "autobahnfahrgestelltestrshinyLogGroupARN9300F2AC": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/LogGroupARN",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LogGroupF5B46931",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyTargetGroupBA7AA523": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/index.html",
        "HealthCheckPort": "8181",
        "HealthCheckTimeoutSeconds": 5,
        "Port": 8181,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "true",
          },
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "60",
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie",
          },
        ],
        "TargetType": "ip",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionF249C912": {
      "Properties": {
        "ContainerDefinitions": [
          {
            "Essential": true,
            "Image": "767398142180.dkr.ecr.eu-central-1.amazonaws.com/autobahn/proxy-r-shiny-alpine-latest:latest",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "ecs-nginx",
              },
            },
            "Name": "NGINX-Proxy",
            "PortMappings": [
              {
                "ContainerPort": 8181,
                "HostPort": 8181,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
          },
          {
            "Command": [],
            "Environment": [
              {
                "Name": "PLATFORM",
                "Value": "FARGATE",
              },
              {
                "Name": "AWS_ACCOUNT_ENV",
                "Value": "tst",
              },
              {
                "Name": "AWS_REGION",
                "Value": "eu-central-1",
              },
              {
                "Name": "ENVIRONMENT",
                "Value": "T",
              },
              {
                "Name": "STS_CLIENT_ID",
                "Value": "test-client-id",
              },
              {
                "Name": "TMPDIR",
                "Value": "/tmp",
              },
              {
                "Name": "APPLICATION_DATA_BUCKET",
                "Value": "entity",
              },
              {
                "Name": "env1",
                "Value": {
                  "Ref": "SsmParameterValueenv1C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env2",
                "Value": {
                  "Ref": "SsmParameterValueenv2C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
              {
                "Name": "env3",
                "Value": {
                  "Ref": "SsmParameterValueenv3C96584B6F00A464EAD1953AFF4B05118Parameter",
                },
              },
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "curl -f http://localhost:8080/index.html || exit 1",
              ],
              "Interval": 30,
              "Retries": 3,
              "StartPeriod": 0,
              "Timeout": 5,
            },
            "Image": {
              "Fn::Join": [
                "",
                [
                  "123456789012.dkr.ecr.eu-central-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/dummy-value-for-/application/v1/autobahn-fahrgestell-test-r-shiny/ecrRepository:0.1.2",
                ],
              ],
            },
            "LinuxParameters": {
              "Capabilities": {},
              "InitProcessEnabled": true,
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "LogGroupF5B46931",
                },
                "awslogs-region": "eu-central-1",
                "awslogs-stream-prefix": "fargate",
              },
            },
            "MountPoints": [
              {
                "ContainerPath": "/tmp",
                "ReadOnly": false,
                "SourceVolume": "tmp-main",
              },
              {
                "ContainerPath": "/var/lib/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-lib-amazon-ssm",
              },
              {
                "ContainerPath": "/var/log/amazon/ssm",
                "ReadOnly": false,
                "SourceVolume": "var-log-amazon-ssm",
              },
              {
                "ContainerPath": "/managed-agents",
                "ReadOnly": false,
                "SourceVolume": "managed-agents",
              },
            ],
            "Name": "appContainer",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 8080,
                "Protocol": "tcp",
              },
            ],
            "ReadonlyRootFilesystem": true,
            "Secrets": [
              {
                "Name": "RDS_DB_INSTANCE",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/hostname",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_SECRET_ARN",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":ssm:eu-central-1:123456789012:parameter/db/Dbautobahnfahrgestelltestrshiny/secretArn",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_USERNAME",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":username::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_PASSWORD",
                "ValueFrom": {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Ref": "SsmParameterValuedbDbautobahnfahrgestelltestrshinysecretArnC96584B6F00A464EAD1953AFF4B05118Parameter",
                      },
                      ":password::",
                    ],
                  ],
                },
              },
              {
                "Name": "RDS_DB_NAME",
                "ValueFrom": {
                  "Ref": "RDSDBNameSecretC11F859F",
                },
              },
            ],
          },
        ],
        "Cpu": "2048",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "autobahnfahrgestelltestrshinyExecutionRoleDF12962C",
            "Arn",
          ],
        },
        "Family": "autobahn-fahrgestell-test-r-shinyFamily",
        "Memory": "16384",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE",
        ],
        "TaskRoleArn": "arn:aws:service:eu-central-1:123456789012:entity/dummy-value",
      },
      "Type": "AWS::ECS::TaskDefinition",
    },
    "autobahnfahrgestelltestrshinyTaskDefinitionNGINXContainerLogGroupA6DCE12E": {
      "DeletionPolicy": "Retain",
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "autobahnfahrgestelltestrshinyecsSecurityGroupID89489D51": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsSecurityGroupID",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "autobahnfahrgestelltestrshinyecsServiceARNB8D9C8AA": {
      "Properties": {
        "Name": "/application/v1/autobahn-fahrgestell-test-r-shiny/ecsServiceARN",
        "Type": "String",
        "Value": {
          "Ref": "autobahnfahrgestelltestrshinyALBFargateServiceF70C675E",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ecsSecurityGroupA27532EA": {
      "Properties": {
        "GroupDescription": "RShinyWithoutUseEFSStack/ecsSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ecsSecurityGroupfromRShinyWithoutUseEFSStackCommonALBListenerSecurityGroupsg1234567890122E51E760818176F8A1A6": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": {
          "Fn::GetAtt": [
            "ecsSecurityGroupA27532EA",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "rdsSecurityGroupfromRShinyWithoutUseEFSStackCommonALBListenerSecurityGroupsg1234567890122E51E7608181D37EE870": {
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 8181,
        "GroupId": "test-rds-security-group-id",
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": "sg-12345678",
        "ToPort": 8181,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;
